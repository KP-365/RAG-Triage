Core idea

The chat agent is not a free chatbot. It’s a guided triage interviewer.

Chat requirements

Ask 1 question at a time

Keep questions short and simple

Confirm important details (“Just to confirm…”)

Detect red flags early and escalate

Always safety-net: if severe red flag appears, respond with urgent instruction and stop.

Outputs (same as before)

answers_json (structured)

band, red_flags, summary

What changes in the architecture?
New components

Chat Session State

Store conversation messages

Store extracted structured fields (JSON)

Store current stage (what question to ask next)

Extraction step
After each user message, run an “extractor” that updates structured fields:

age, sex, complaint

onset, severity

red flags: collapse, confusion, severe bleeding, SOB, etc.

For Replit prototype you can do extraction in two ways:

Option A (recommended for Replit): “Rules + patterns” extraction (no LLM needed)

Fast and deterministic

Works for MVP

Not perfect but fine for prototype

Option B: Use an LLM for extraction only

More accurate

But external API unless you run local model

Still safe if you don’t let it decide urgency, only fill fields

What to code first now (new order)

Backend: chat endpoints + session store

Chat UI

Rules engine to assign band

RAG explanations for clinician

Front-end still comes after backend.

Replit Implementation: Chat MVP (exact endpoints)
Backend endpoints (FastAPI)

POST /api/chat/start

creates a session and returns first assistant message

POST /api/chat/message

input: { session_id, message }

output: assistant reply + updated structured state + (optional) band if ready

POST /api/chat/finish

saves submission to DB and returns submission_id + result

DB tables (add this)

chat_sessions

id, created_at, messages_json, state_json, status

You already have submissions

Chat “state machine” (simple and reliable)

The agent has stages:

Greeting + age check

Chief complaint

Onset + severity

Red flag checks based on complaint

Summary confirmation

Finish

Example stage logic for chest pain:

“Are you having chest pain?”

“When did it start?”

“How severe 0–10?”

“Any shortness of breath?”

“Did you collapse or faint?”

“Is the pain spreading to your arm/jaw?”

“Are you sweating or feeling clammy?”

Then summarise and finish.

This feels like an AI chat but behaves like a safe scripted triage interview.

Frontend: replace PatientForm with Chat page

Chat UI needs:

chat bubbles

typing box

send button

show “assistant is typing” optional

store session_id